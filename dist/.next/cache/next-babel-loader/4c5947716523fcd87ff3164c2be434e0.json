{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport fetch from 'isomorphic-unfetch';\nimport { omit } from 'lodash';\nimport cookie from 'js-cookie';\nimport { isUrl } from '@lib/string';\nimport env from '../env';\nexport var TOKEN = 'token';\nexport var ROLE = 'role';\nexport var PERFORMER_ROLE = 'performer';\nexport var USER_ROLE = 'user';\nexport var STUDIO_ROLE = 'studio';\nexport var SORT = {\n  descend: 'desc',\n  ascend: 'asc'\n};\nexport var APIRequest = /*#__PURE__*/function () {\n  function APIRequest() {\n    _classCallCheck(this, APIRequest);\n\n    _defineProperty(this, \"token\", null);\n  }\n\n  _createClass(APIRequest, [{\n    key: \"setAuthHeaderToken\",\n    value: function setAuthHeaderToken(token) {\n      this.token = token;\n    }\n    /**\n     * Parses the JSON returned by a network request\n     *\n     * @param  {object} response A response from a network request\n     *\n     * @return {object}          The parsed JSON from the request\n     */\n\n  }, {\n    key: \"parseJSON\",\n    value: function parseJSON(response) {\n      if (response.status === 204 || response.status === 205) {\n        return null;\n      }\n\n      return response.json();\n    }\n    /**\n     * Checks if a network request came back fine, and throws an error if not\n     *\n     * @param  {object} response   A response from a network request\n     *\n     * @return {object|undefined} Returns either the response, or throws an error\n     */\n\n  }, {\n    key: \"checkStatus\",\n    value: function () {\n      var _checkStatus = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(response.status >= 200 && response.status < 300)) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", response);\n\n              case 2:\n                if (!(response.status === 403)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                if (!true) {\n                  _context.next = 6;\n                  break;\n                }\n\n                window.location.href = '/';\n                throw new Error('Forbidden in the action!');\n\n              case 6:\n                throw response.clone().json();\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function checkStatus(_x) {\n        return _checkStatus.apply(this, arguments);\n      }\n\n      return checkStatus;\n    }()\n  }, {\n    key: \"request\",\n    value: function request(url, method, body, headers) {\n      var verb = (method || 'get').toUpperCase();\n\n      var updatedHeader = _objectSpread({\n        'Content-Type': 'application/json',\n        // TODO - check me\n        Authorization: this.token || (true ? cookie.get(TOKEN) : '')\n      }, headers || {});\n\n      return fetch(isUrl(url) ? url : \"\".concat(env.apiEndpoint).concat(url), {\n        method: verb,\n        headers: updatedHeader,\n        body: body ? JSON.stringify(body) : null\n      }).then(this.checkStatus).then(this.parseJSON);\n    }\n  }, {\n    key: \"buildUrl\",\n    value: function buildUrl(baseUrl, params) {\n      if (!params) {\n        return baseUrl;\n      }\n\n      var queryString = Object.keys(params).map(function (k) {\n        return \"\".concat(encodeURIComponent(k), \"=\").concat(encodeURIComponent(params[k]));\n      }).join('&');\n      return \"\".concat(baseUrl, \"?\").concat(queryString);\n    }\n  }, {\n    key: \"get\",\n    value: function get(url, headers) {\n      return this.request(url, 'get', null, headers);\n    }\n  }, {\n    key: \"post\",\n    value: function post(url, data, headers) {\n      return this.request(url, 'post', data, headers);\n    }\n  }, {\n    key: \"put\",\n    value: function put(url, data, headers) {\n      return this.request(url, 'put', data, headers);\n    }\n  }, {\n    key: \"del\",\n    value: function del(url, data, headers) {\n      return this.request(url, 'delete', data, headers);\n    }\n  }, {\n    key: \"upload\",\n    value: function upload(url, files) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n        onProgress: function onProgress() {},\n        method: 'POST'\n      };\n      var uploadUrl = isUrl(url) ? url : \"\".concat(env.apiEndpoint).concat(url);\n      return new Promise(function (resolve, reject) {\n        var req = new XMLHttpRequest();\n        req.upload.addEventListener('progress', function (event) {\n          if (event.lengthComputable) {\n            options.onProgress({\n              percentage: event.loaded / event.total * 100\n            });\n          }\n        });\n        req.addEventListener('load', function () {\n          var success = req.status >= 200 && req.status < 300;\n          var response = req.response;\n\n          if (!success) {\n            return reject(response);\n          }\n\n          return resolve(response);\n        });\n        req.upload.addEventListener('error', function () {\n          reject(req.response);\n        });\n        var formData = new FormData();\n        files.forEach(function (f) {\n          return formData.append(f.fieldname, f.file, f.file.name);\n        });\n        options.customData && Object.keys(options.customData).forEach(function (fieldname) {\n          return typeof options.customData[fieldname] !== 'undefined' && formData.append(fieldname, options.customData[fieldname]);\n        });\n        req.responseType = 'json';\n        req.open(options.method || 'POST', uploadUrl);\n        var token = cookie.get(TOKEN);\n\n        if (token) {\n          req.setRequestHeader('Authorization', token);\n        }\n\n        req.send(formData);\n      });\n    }\n  }, {\n    key: \"register\",\n    value: function register(url, data) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n        onProgress: function onProgress() {}\n      };\n      return new Promise(function (resolve, reject) {\n        var req = new XMLHttpRequest();\n        req.upload.addEventListener('progress', function (event) {\n          if (event.lengthComputable) {\n            options.onProgress({\n              percentage: event.loaded / event.total * 100\n            });\n          }\n        });\n        req.addEventListener('load', function () {\n          var success = req.status >= 200 && req.status < 300;\n          var response = req.response;\n\n          if (!success) {\n            return reject(response);\n          }\n\n          return resolve(response);\n        });\n        req.upload.addEventListener('error', function () {\n          reject(req.response);\n        });\n        var formData = new FormData(); // formData.append('file', file, file.name);\n\n        if (data.documentVerification) {\n          var documentVerificationFile = data.documentVerification.file.originFileObj;\n          formData.append('documentVerification', documentVerificationFile, documentVerificationFile.name);\n        }\n\n        if (data.idVerification) {\n          var idVerificationDile = data.idVerification.file.originFileObj;\n          formData.append('idVerification', idVerificationDile, idVerificationDile.name);\n        }\n\n        Object.keys(omit(data, ['documentVerification', 'idVerification'])).forEach(function (v) {\n          formData.append(v, data[v]);\n        });\n        req.responseType = 'json';\n        req.open('POST', isUrl(url) ? url : \"\".concat(env.apiEndpoint).concat(url));\n        var token = cookie.get(TOKEN);\n\n        if (token) {\n          req.setRequestHeader('Authorization', token);\n        }\n\n        req.send(formData);\n      });\n    }\n  }]);\n\n  return APIRequest;\n}();","map":null,"metadata":{},"sourceType":"module"}